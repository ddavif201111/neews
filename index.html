<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #1a1a1a; color: white; margin: 0; font-family: sans-serif; overflow: hidden; touch-action: none; display: flex; flex-direction: column; height: 100vh; }
        .header { text-align: center; padding: 15px; background: #2c2c2c; border-radius: 0 0 20px 20px; z-index: 10; }
        #balance { font-size: 34px; font-weight: bold; color: #ffdf00; margin: 0; }
        
        .lvl-bar { width: 80%; background: #444; height: 8px; border-radius: 4px; margin: 8px auto; overflow: hidden; position: relative; }
        #lvl-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #4cd137, #b8ff9e); transition: width 0.3s; }
        
        .page { display: none; flex-grow: 1; flex-direction: column; align-items: center; justify-content: center; width: 100%; }
        .active { display: flex; }

        .coin-wrap { position: relative; display: flex; align-items: center; justify-content: center; width: 220px; height: 220px; }
        #coin { width: 100%; height: 100%; background: radial-gradient(circle, #ffdf00, #d4af37); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 80px; box-shadow: 0 0 30px rgba(255,223,0,0.3); user-select: none; z-index: 5; }
        #coin:active { transform: scale(0.96); }

        .card { background: #2c2c2c; width: 85%; padding: 15px; border-radius: 15px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center; border: 1px solid #3d3d3d; }
        .btn { background: #0088cc; color: white; border: none; padding: 10px 15px; border-radius: 10px; font-weight: bold; }
        
        .nav { height: 75px; display: flex; background: #2c2c2c; justify-content: space-around; align-items: center; border-top: 1px solid #3d3d3d; padding-bottom: 10px; }
        .nav-item { opacity: 0.4; font-size: 11px; text-align: center; flex: 1; color: white; text-decoration: none; }
        .nav-item.active { opacity: 1; color: #0088cc; }
        .nav-item span { font-size: 20px; display: block; }
    </style>
</head>
<body>

<div class="header">
    <div style="font-size: 12px; color: #aaa; margin-bottom: 4px;" id="lvl-txt">–†—ñ–≤–µ–Ω—å 1</div>
    <div class="lvl-bar"><div id="lvl-fill"></div></div>
    <p id="balance">0</p>
</div>

<div id="game-pg" class="page active">
    <div class="coin-wrap">
        <div id="coin" onpointerdown="tap(event)">üí∞</div>
    </div>
    <div style="width: 80%; margin-top: 40px;">
        <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px;">
            <span>‚ö° –ï–Ω–µ—Ä–≥—ñ—è: <span id="energy">1000</span></span>
            <span>–ö–ª—ñ–∫: <span id="pwr-val">1</span></span>
        </div>
        <div style="background: #333; height: 10px; border-radius: 5px; overflow: hidden;"><div id="en-bar" style="background: orange; width: 100%; height: 100%;"></div></div>
    </div>
</div>

<div id="shop-pg" class="page">
    <div class="card"><div><b>–ú—É–ª—å—Ç–∏-–∫–ª—ñ–∫</b><br><small>–¶—ñ–Ω–∞: <span id="p-price">50</span></small></div><button class="btn" onclick="buy('p')">UP</button></div>
    <div class="card"><div><b>–ê–≤—Ç–æ-—Ñ–µ—Ä–º–∞</b><br><small>–¶—ñ–Ω–∞: <span id="f-price">150</span></small></div><button class="btn" onclick="buy('f')">UP</button></div>
</div>

<div id="task-pg" class="page">
    <div class="card"><div><b>–ë–æ–Ω—É—Å –Ω–æ–≤–∞—á–∫–∞</b><br><small>+1,000 –º–æ–Ω–µ—Ç</small></div><button class="btn" id="q-start" onclick="claim()">–û—Ç—Ä–∏–º–∞—Ç–∏</button></div>
</div>

<div class="nav">
    <div class="nav-item active" onclick="nav('game-pg', this)"><span>üéÆ</span>–ì—Ä–∞</div>
    <div class="nav-item" onclick="nav('shop-pg', this)"><span>üõí</span>–ú–∞–≥–∞–∑–∏–Ω</div>
    <div class="nav-item" onclick="nav('task-pg', this)"><span>üìù</span>–ó–∞–≤–¥–∞–Ω–Ω—è</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();let coins = parseInt(localStorage.getItem('c')) || 0;
    let pLvl = parseInt(localStorage.getItem('pl')) || 1;
    let fLvl = parseInt(localStorage.getItem('fl')) || 0;
    let xp = parseInt(localStorage.getItem('xp')) || 0;
    let energy = 1000;

    const emojis = ["üí∞", "ü•â", "ü•à", "ü•á", "üíé", "üëë", "üî•"];
    const lvlNames = ["–ù–æ–≤–∞—á–æ–∫", "–ë—Ä–æ–Ω–∑–∞", "–°—Ä—ñ–±–ª–æ", "–ó–æ–ª–æ—Ç–æ", "–ü–ª–∞—Ç–∏–Ω–∞", "–î—ñ–∞–º–∞–Ω—Ç", "–õ–µ–≥–µ–Ω–¥–∞"];

    function getLevelData(currentXp) {
        if (currentXp < 1000) return { lvl: 1, min: 0, max: 1000 };
        if (currentXp < 3000) return { lvl: 2, min: 1000, max: 3000 };
        if (currentXp < 6000) return { lvl: 3, min: 3000, max: 6000 };
        if (currentXp < 8000) return { lvl: 4, min: 6000, max: 8000 };
        // –î–ª—è —Ä—ñ–≤–Ω—ñ–≤ 5+ –∫—Ä–æ–∫ –ø–æ 5000
        let base = 8000;
        let step = 5000;
        let extraLvls = Math.floor((currentXp - base) / step) + 1;
        return { 
            lvl: 4 + extraLvls, 
            min: base + (extraLvls - 1) * step, 
            max: base + extraLvls * step 
        };
    }

    function update() {
        let pwr = Math.round(Math.pow(1.5, pLvl - 1));
        let ps = fLvl === 0 ? 0 : Math.round(2 * Math.pow(1.5, fLvl - 1));
        
        let lvlData = getLevelData(xp);
        let progress = ((xp - lvlData.min) / (lvlData.max - lvlData.min)) * 100;

        document.getElementById('balance').innerText = Math.floor(coins).toLocaleString();
        document.getElementById('energy').innerText = Math.floor(energy);
        document.getElementById('en-bar').style.width = (energy / 10) + '%';
        document.getElementById('pwr-val').innerText = pwr;
        
        document.getElementById('lvl-fill').style.width = progress + '%';
        document.getElementById('lvl-txt').innerText = –†—ñ–≤–µ–Ω—å ${lvlData.lvl}: ${lvlNames[lvlData.lvl-1] || "–ú–∞–π—Å—Ç–µ—Ä"};
        document.getElementById('coin').innerText = emojis[lvlData.lvl-1] || "üî•";
        
        document.getElementById('p-price').innerText = Math.floor(50 * Math.pow(2, pLvl - 1));
        document.getElementById('f-price').innerText = Math.floor(150 * Math.pow(2.2, fLvl));

        localStorage.setItem('c', coins);
        localStorage.setItem('pl', pLvl);
        localStorage.setItem('fl', fLvl);
        localStorage.setItem('xp', xp);
    }

    function tap(e) {
        if (e.cancelable) e.preventDefault();
        let pwr = Math.round(Math.pow(1.5, pLvl - 1));
        if (energy >= 1) {
            coins += pwr;
            energy--;
            xp += 1; // –ö–æ–∂–µ–Ω –∫–ª—ñ–∫ = 1 XP
            tg.HapticFeedback.impactOccurred('light');
            update();
        }
    }

    function buy(type) {
        let pPrice = Math.floor(50 * Math.pow(2, pLvl - 1));
        let fPrice = Math.floor(150 * Math.pow(2.2, fLvl));
        if (type === 'p' && coins >= pPrice) { coins -= pPrice; pLvl++; }
        else if (type === 'f' && coins >= fPrice) { coins -= fPrice; fLvl++; }
        update();
    }

    function claim() {
        if (localStorage.getItem('cl') !== 'y') {
            coins += 1000; localStorage.setItem('cl', 'y');
            document.getElementById('q-start').innerText = "‚úÖ"; update();
        }
    }

    function nav(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    }

    setInterval(() => {
        let ps = fLvl === 0 ? 0 : Math.round(2 * Math.pow(1.5, fLvl - 1));
        if (ps > 0) coins += (ps / 10);
        if (energy < 1000) energy++;
        update();
    }, 100);

    update();
</script>
</body>
</html>
