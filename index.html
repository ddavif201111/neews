<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background: #1a1a1a; color: white; margin: 0; padding: 0;
            font-family: sans-serif; overflow: hidden; touch-action: none;
            display: flex; flex-direction: column; height: 100vh;
        }
        .header { text-align: center; padding: 15px; background: #2c2c2c; border-radius: 0 0 20px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        #balance { font-size: 36px; font-weight: bold; color: #ffdf00; margin: 0; }
        
        .page { display: none; flex-grow: 1; flex-direction: column; align-items: center; width: 100%; padding-top: 20px; overflow-y: auto; }
        .active-page { display: flex; }

        #coin {
            width: 210px; height: 210px; background: radial-gradient(circle, #ffdf00, #d4af37); 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-size: 80px; box-shadow: 0 0 30px rgba(255,223,0,0.3); user-select: none;
            transition: transform 0.05s;
        }
        #coin:active { transform: scale(0.95); }

        .card { background: #2c2c2c; width: 88%; padding: 15px; border-radius: 14px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #3d3d3d; }
        .btn { background: #0088cc; color: white; border: none; padding: 10px 16px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn:disabled { opacity: 0.3; cursor: default; }

        .nav { height: 75px; display: flex; background: #2c2c2c; justify-content: space-around; align-items: center; border-top: 1px solid #3d3d3d; padding-bottom: 10px; }
        .nav-item { opacity: 0.5; font-size: 11px; text-align: center; flex: 1; transition: 0.2s; }
        .nav-item.active { opacity: 1; color: #0088cc; transform: translateY(-3px); }
        .nav-item span { font-size: 22px; display: block; margin-bottom: 4px; }

        .ref-box { background: #111; padding: 10px; border-radius: 8px; width: 100%; margin-top: 10px; font-size: 11px; color: #888; overflow-wrap: break-word; }
    </style>
</head>
<body>

<div class="header">
    <p id="balance">0</p>
    <div style="font-size: 12px; color: #4cd137; margin-top: 4px;">–ü—Ä–∏–±—É—Ç–æ–∫: +<span id="ps-val">0</span>/—Å–µ–∫</div>
</div>

<div id="game-pg" class="page active-page">
    <div id="coin" onpointerdown="tap(event)">üí∞</div>
    <div style="width: 85%; margin-top: 40px;">
        <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 6px;">
            <span>‚ö° –ï–Ω–µ—Ä–≥—ñ—è: <span id="energy">1000</span> / 1000</span>
            <span>–ö–ª—ñ–∫: <span id="pwr-val">1</span></span>
        </div>
        <div style="background: #333; height: 10px; border-radius: 5px; overflow: hidden; border: 1px solid #444;">
            <div id="en-bar" style="background: orange; width: 100%; height: 100%;"></div>
        </div>
    </div>
</div>

<div id="shop-pg" class="page">
    <div class="card">
        <div><b>–ú—É–ª—å—Ç–∏-–∫–ª—ñ–∫</b><br><small>–†—ñ–≤–µ–Ω—å <span id="p-lvl">1</span></small></div>
        <button class="btn" id="buy-p" onclick="buy('p')">0</button>
    </div>
    <div class="card">
        <div><b>–§–µ—Ä–º–∞ (AFK)</b><br><small>–î–æ—Ö—ñ–¥: <span id="f-ps">0</span>/—Å</small></div>
        <button class="btn" id="buy-f" onclick="buy('f')">0</button>
    </div>
</div>

<div id="ref-pg" class="page">
    <h3 style="margin: 0 0 10px 0;">–ó–∞–ø—Ä–æ—Å–∏ –¥—Ä—É–∑—ñ–≤</h3>
    <p style="font-size: 13px; color: #aaa; text-align: center; width: 80%;">–û—Ç—Ä–∏–º—É–π 5,000 –º–æ–Ω–µ—Ç –∑–∞ –∫–æ–∂–Ω–æ–≥–æ –¥—Ä—É–≥–∞!</p>
    <div class="card" style="flex-direction: column; align-items: flex-start;">
        <span style="font-size: 14px;">–¢–≤–æ—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è:</span>
        <div class="ref-box" id="ref-link">https://t.me/your_bot?start=user123</div><button class="btn" style="width: 100%; margin-top: 10px;" onclick="copyRef()">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
    </div>
</div>

<div id="task-pg" class="page">
    <div class="card">
        <div><b>–ë–æ–Ω—É—Å –Ω–æ–≤–∞—á–∫–∞</b><br><small>+1,000 –º–æ–Ω–µ—Ç</small></div>
        <button class="btn" id="q-start" onclick="claimStart()">–û—Ç—Ä–∏–º–∞—Ç–∏</button>
    </div>
    <div class="card">
        <div><b>–©–æ–¥–µ–Ω–Ω–∞ –Ω–∞–≥–æ—Ä–æ–¥–∞</b><br><small>+5,000 –º–æ–Ω–µ—Ç</small></div>
        <button class="btn" id="daily-btn" onclick="dailyClaim()">–û—Ç—Ä–∏–º–∞—Ç–∏</button>
    </div>
</div>

<div class="nav">
    <div class="nav-item active" onclick="nav('game-pg', this)"><span>üéÆ</span>–ì—Ä–∞</div>
    <div class="nav-item" onclick="nav('shop-pg', this)"><span>üõí</span>–ú–∞–≥–∞–∑–∏–Ω</div>
    <div class="nav-item" onclick="nav('ref-pg', this)"><span>üë•</span>–î—Ä—É–∑—ñ</div>
    <div class="nav-item" onclick="nav('task-pg', this)"><span>üìù</span>–ó–∞–≤–¥–∞–Ω–Ω—è</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();

    let coins = parseInt(localStorage.getItem('coins')) || 0;
    let pLvl = parseInt(localStorage.getItem('pLvl')) || 1;
    let fLvl = parseInt(localStorage.getItem('fLvl')) || 0;
    let lastDaily = localStorage.getItem('lastDaily') || "";
    let startClaimed = localStorage.getItem('startClaimed') || "false";
    let energy = 1000;

    // –†–µ—Ñ–µ—Ä–∞–ª–∫–∞
    const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "123";
    const botLink = "https://t.me/–¢–í–Ü–ô_–ë–û–¢?start=" + userId;
    document.getElementById('ref-link').innerText = botLink;

    function update() {
        let pwr = Math.round(Math.pow(1.5, pLvl - 1));
        let ps = fLvl === 0 ? 0 : Math.round(2 * Math.pow(1.5, fLvl - 1));
        
        document.getElementById('balance').innerText = Math.floor(coins).toLocaleString();
        document.getElementById('energy').innerText = Math.floor(energy);
        document.getElementById('en-bar').style.width = (energy / 10) + '%';
        document.getElementById('pwr-val').innerText = pwr;
        document.getElementById('ps-val').innerText = ps;
        
        let pPrice = Math.floor(50 * Math.pow(2, pLvl - 1));
        let fPrice = Math.floor(150 * Math.pow(2.2, fLvl));
        
        document.getElementById('buy-p').innerText = pPrice;
        document.getElementById('buy-f').innerText = fPrice;
        document.getElementById('p-lvl').innerText = pLvl;
        document.getElementById('f-ps').innerText = ps;
        
        document.getElementById('buy-p').disabled = coins < pPrice;
        document.getElementById('buy-f').disabled = coins < fPrice;

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–≤–¥–∞–Ω—å
        if(startClaimed === "true") {
            document.getElementById('q-start').innerText = "‚úÖ";
            document.getElementById('q-start').disabled = true;
        }
        const today = new Date().toDateString();
        if(lastDaily === today) {
            document.getElementById('daily-btn').innerText = "‚úÖ";
            document.getElementById('daily-btn').disabled = true;
        }

        localStorage.setItem('coins', coins);
        localStorage.setItem('pLvl', pLvl);
        localStorage.setItem('fLvl', fLvl);
    }

    function tap(e) {
        if (e.cancelable) e.preventDefault();
        let pwr = Math.round(Math.pow(1.5, pLvl - 1));
        if (energy >= 1) {
            coins += pwr; energy -= 1;
            tg.HapticFeedback.impactOccurred('light');
            update();
        }
    }

    function buy(type) {
        if (type === 'p') {
            let pr = Math.floor(50 * Math.pow(2, pLvl - 1));
            if (coins >= pr) { coins -= pr; pLvl++; }
        } else {
            let pr = Math.floor(150 * Math.pow(2.2, fLvl));
            if (coins >= pr) { coins -= pr; fLvl++; }
        }
        update();
    }

    function claimStart() {
        coins += 1000;
        startClaimed = "true";
        localStorage.setItem('startClaimed', "true");
        update();
        tg.showAlert("–û—Ç—Ä–∏–º–∞–Ω–æ –±–æ–Ω—É—Å –Ω–æ–≤–∞—á–∫–∞!");
    }

    function dailyClaim() {
        const today = new Date().toDateString();
        coins += 5000;lastDaily = today;
        localStorage.setItem('lastDaily', today);
        update();
        tg.showAlert("–©–æ–¥–µ–Ω–Ω–∞ –Ω–∞–≥–æ—Ä–æ–¥–∞ –æ—Ç—Ä–∏–º–∞–Ω–∞!");
    }

    function copyRef() {
        navigator.clipboard.writeText(botLink);
        tg.showAlert("–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!");
    }

    function nav(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active-page');
        el.classList.add('active');
    }

    setInterval(() => {
        let ps = fLvl === 0 ? 0 : Math.round(2 * Math.pow(1.5, fLvl - 1));
        if (ps > 0) coins += (ps / 10);
        if (energy < 1000) energy++;
        update();
    }, 100);

    update();
</script>
</body>
</html>
