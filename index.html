<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –ë–ª–æ–∫—É—î–º–æ –≤—Å–µ –∑–∞–π–≤–µ, —â–æ–± –Ω–µ –∑–∞–≤–∞–∂–∞–ª–æ –∫–ª—ñ–∫–∞—Ç–∏ */
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none; 
            touch-action: none; 
        }
        
        body { 
            background: #0d0d0d; color: white; margin: 0; font-family: sans-serif; 
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }
        
        .header { padding: 15px; background: #151515; text-align: center; border-bottom: 1px solid #222; }
        #balance { font-size: 36px; font-weight: 900; color: #f3ba2f; text-shadow: 0 0 10px rgba(243,186,47,0.3); }

        /* –ó–æ–Ω–∞ –¥–ª—è –∫–ª—ñ–∫—É */
        #game-area { 
            flex: 1; display: flex; align-items: center; justify-content: center; 
            position: relative; width: 100%; 
        }
        
        #coin { 
            width: 250px; height: 250px; background: radial-gradient(circle, #2a2a2a, #000); 
            border: 6px solid #f3ba2f; border-radius: 50%; display: flex; align-items: center; 
            justify-content: center; font-size: 110px; cursor: pointer;
            transition: transform 0.05s ease; z-index: 10;
            box-shadow: 0 0 40px rgba(243,186,47,0.1);
        }

        /* –ê–Ω—ñ–º–∞—Ü—ñ—è —Ü–∏—Ñ—Ä–∏ */
        .pop {
            position: absolute; color: #f3ba2f; font-size: 32px; font-weight: 900;
            pointer-events: none; animation: fly 0.7s ease-out forwards; z-index: 100;
        }

        @keyframes fly {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-150px) scale(1.2); opacity: 0; }
        }

        /* –ù–∏–∂–Ω—è –ø–∞–Ω–µ–ª—å –µ–Ω–µ—Ä–≥—ñ—ó */
        .footer { padding: 20px; width: 100%; }
        .energy-text { display: flex; justify-content: space-between; font-size: 16px; margin-bottom: 8px; }
        .energy-bar { width: 100%; background: #222; height: 12px; border-radius: 10px; overflow: hidden; }
        #energy-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #f3ba2f, #ffaa00); transition: width 0.1s; }

        /* –ù–∞–≤—ñ–≥–∞—Ü—ñ—è */
        .nav { display: flex; background: #151515; border-top: 1px solid #222; padding-bottom: 20px; height: 80px; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #666; font-size: 12px; }
        .nav-item.active { color: #f3ba2f; }
        
        .page { display: none; flex: 1; flex-direction: column; align-items: center; padding: 20px; }
        .active-page { display: flex; }
    </style>
</head>
<body>

<div class="header">
    <div id="balance">0</div>
</div>

<div id="pg-game" class="page active-page">
    <div id="game-area">
        <div id="coin">üêº</div>
    </div>
    <div class="footer">
        <div class="energy-text">
            <span>‚ö° <span id="energy">1000</span> / 1000</span>
            <span style="color:#888">Power: +<span id="pwr">1</span></span>
        </div>
        <div class="energy-bar"><div id="energy-fill"></div></div>
    </div>
</div>

<div id="pg-shop" class="page">
    <h2 style="color:#f3ba2f">Shop</h2>
    <div style="background:#1a1a1a; padding:20px; border-radius:15px; width:100%; display:flex; justify-content:space-between; align-items:center;">
        <div><b>Multi-Tap</b><br><small id="price-tag">Cost: 50</small></div>
        <button onclick="buyTap()" style="background:#0088cc; border:none; color:white; padding:10px 20px; border-radius:10px; font-weight:bold;">UP</button>
    </div>
</div>

<div class="nav">
    <div class="nav-item active" onclick="showPage('pg-game', this)"><span>üöÄ</span>Game</div>
    <div class="nav-item" onclick="showPage('pg-shop', this)"><span>üõí</span>Shop</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    let coins = Number(localStorage.getItem('coins')) || 0;
    let power = Number(localStorage.getItem('power')) || 1;
    let energy = Number(localStorage.getItem('energy')) || 1000;
    const maxEnergy = 1000;

    function update() {
        document.getElementById('balance').innerText = Math.floor(coins).toLocaleString();
        document.getElementById('energy').innerText = Math.floor(energy);
        document.getElementById('energy-fill').style.width = (energy / maxEnergy * 100) + '%';
        document.getElementById('pwr').innerText = power;
        document.getElementById('price-tag').innerText = "Cost: " + Math.floor(50 * Math.pow(2, power - 1));

        localStorage.setItem('coins', coins);
        localStorage.setItem('power', power);
        localStorage.setItem('energy', energy);
    }

    // –ì–û–õ–û–í–ù–ò–ô –ö–õ–Ü–ö
    const coin = document.getElementById('coin');

    function handleAction(e) {
        if (energy >= power) {
            coins += power;
            energy -= power;

            // –°—Ç–≤–æ—Ä—é—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é —Ü–∏—Ñ—Ä–∏
            const rect = coin.getBoundingClientRect();
            const x = e.clientX || (e.touches ? e.touches[0].clientX : rect.left + rect.width / 2);
            const y = e.clientY || (e.touches ? e.touches[0].clientY : rect.top + rect.height / 2);

            const pop = document.createElement('div');
            pop.className = 'pop';
            pop.innerText = +${power};
            pop.style.left = ${x - 20}px;
            pop.style.top = ${y - 40}px;
            document.body.appendChild(pop);
            setTimeout(() => pop.remove(), 700);

            // –ê–Ω—ñ–º–∞—Ü—ñ—è —Å—Ç–∏—Å–∫–∞–Ω–Ω—è
            coin.style.transform = 'scale(0.95)';
            setTimeout(() => coin.style.transform = 'scale(1)', 50);

            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            update();
        }
    }

    // –°–ª—É—Ö–∞—î–º–æ —ñ —Ç–∞—á, —ñ –∫–ª—ñ–∫ –º–∏—à–∫–æ—é
    coin.addEventListener('pointerdown', (e) => {
        handleAction(e);
    });

    function showPage(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active-page');
        el.classList.add('active');
    }

    function buyTap() {
        let cost = Math.floor(50 * Math.pow(2, power - 1));
        if (coins >= cost) {
            coins -= cost;
            power++;
            update();
            if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
        }
    }

    // –†–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –µ–Ω–µ—Ä–≥—ñ—ó
    setInterval(() => {
        if (energy < maxEnergy) {
            energy = Math.min(maxEnergy, energy + 2);
            update();
        }
    }, 1000);

    update();
</script>
</body>
</html>
