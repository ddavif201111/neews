<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { 
            background: #0f0f0f; color: white; margin: 0; font-family: -apple-system, sans-serif; 
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }
        .header { padding: 15px; background: #1a1a1a; border-radius: 0 0 20px 20px; text-align: center; border-bottom: 1px solid #333; }
        #balance { font-size: 36px; font-weight: 800; color: #ffdf00; margin: 5px 0; }
        
        .lvl-bar-bg { width: 60%; background: #333; height: 6px; border-radius: 10px; margin: 5px auto; overflow: hidden; }
        #lvl-fill { height: 100%; width: 0%; background: #00c6ff; transition: width 0.3s; }
        
        .page { display: none; flex: 1; flex-direction: column; align-items: center; justify-content: center; width: 100%; }
        .active { display: flex !important; }

        /* –°—Ç–∏–ª—å–Ω–∞ –º–æ–Ω–µ—Ç–∞-–ø–∞–Ω–¥–∞ */
        #coin { 
            width: 220px; height: 220px; background: radial-gradient(circle, #333, #000); 
            border: 6px solid #ffdf00; border-radius: 50%; display: flex; align-items: center; 
            justify-content: center; font-size: 90px; box-shadow: 0 0 30px rgba(255,223,0,0.2); 
            cursor: pointer; transition: transform 0.05s;
        }
        #coin:active { transform: scale(0.95); }

        /* –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –≤ —Å—Ç–∏–ª—ñ Web3 */
        .nav { 
            height: 80px; display: flex; background: #1a1a1a; 
            justify-content: center; align-items: center; gap: 20px; 
            border-top: 1px solid #333; padding-bottom: 15px;
        }
        .nav-item { opacity: 0.4; font-size: 11px; text-align: center; width: 70px; cursor: pointer; }
        .nav-item.active { opacity: 1; color: #0088cc; }
        .nav-item span { font-size: 24px; display: block; margin-bottom: 2px; }

        .card { background: #1e1e1e; width: 90%; padding: 15px; border-radius: 15px; margin: 8px 0; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; }
        .btn { background: #0088cc; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; }
        
        #lvl-up-msg { position: fixed; top: 20%; width: 100%; text-align: center; font-size: 40px; display: none; z-index: 100; text-shadow: 0 0 20px gold; }
    </style>
</head>
<body>

<div id="lvl-up-msg">üéâ –ù–û–í–ò–ô –†–Ü–í–ï–ù–¨!</div>

<div class="header">
    <div style="font-size: 11px; color: #888; text-transform: uppercase;" id="lvl-txt">Baby Panda</div>
    <div class="lvl-bar-bg"><div id="lvl-fill"></div></div>
    <div id="balance">0</div>
</div>

<div id="pg-game" class="page active">
    <div id="coin">üêº</div>
    <div style="width: 80%; margin-top: 30px;">
        <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 5px;">
            <span>‚ö° –ï–Ω–µ—Ä–≥—ñ—è: <span id="energy">1000</span></span>
            <span>–ö–ª—ñ–∫: +<span id="pwr-val">1</span></span>
        </div>
        <div class="lvl-bar-bg" style="width: 100%; height: 8px;"><div id="en-bar" style="background: orange; width: 100%; height: 100%;"></div></div>
    </div>
</div>

<div id="pg-shop" class="page">
    <div class="card">
        <div><b>Multi-Tap</b><br><small>–¶—ñ–Ω–∞: <span id="p-price">50</span></small></div>
        <button class="btn" id="buy-tap">UP</button>
    </div>
</div>

<div id="pg-task" class="page">
    <div class="card">
        <div><b>–°—Ç–∞—Ä—Ç–æ–≤–∏–π –±–æ–Ω—É—Å</b><br><small>+1,000 –º–æ–Ω–µ—Ç</small></div>
        <button class="btn" id="claim-btn">–í–ó–Ø–¢–ò</button>
    </div>
</div>

<div class="nav">
    <div class="nav-item active" id="n-game"><span>üöÄ</span>–ü—Ä–æ—î–∫—Ç</div>
    <div class="nav-item" id="n-shop"><span>üõí</span>–ú–∞–≥–∞–∑–∏–Ω</div><div class="nav-item" id="n-task"><span>üìù</span>–ó–∞–≤–¥–∞–Ω–Ω—è</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();

    let coins = Number(localStorage.getItem('c')) || 0;
    let xp = Number(localStorage.getItem('xp')) || 0;
    let pLvl = Number(localStorage.getItem('pl')) || 1;
    let energy = 1000;
    let lastLvl = 1;

    const characters = ["üêº", "üê®", "üêª", "üêØ", "ü¶Å", "üêâ"];

    function update() {
        // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è –∑–∞ —Ç–≤–æ—ó–º–∏ —Ü–∏—Ñ—Ä–∞–º–∏
        let lvl = 1;
        let minXp = 0;
        let maxXp = 1000;
        let name = "Baby Panda";

        if (xp >= 1000 && xp < 3000) { lvl = 2; minXp = 1000; maxXp = 3000; name = "Warrior Panda"; }
        else if (xp >= 3000 && xp < 6000) { lvl = 3; minXp = 3000; maxXp = 6000; name = "Cyber Panda"; }
        else if (xp >= 6000 && xp < 8000) { lvl = 4; minXp = 6000; maxXp = 8000; name = "Elite Guardian"; }
        else if (xp >= 8000) { lvl = 5; minXp = 8000; maxXp = 13000; name = "Techno King"; }

        // –ê–Ω—ñ–º–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ —Ä—ñ–≤–Ω—è
        if (lvl > lastLvl) {
            lastLvl = lvl;
            document.getElementById('lvl-up-msg').style.display = 'block';
            tg.HapticFeedback.notificationOccurred('success');
            setTimeout(() => { document.getElementById('lvl-up-msg').style.display = 'none'; }, 2500);
        }

        // –†–µ–Ω–¥–µ—Ä —Ç–µ–∫—Å—Ç—É
        document.getElementById('balance').innerText = Math.floor(coins).toLocaleString();
        document.getElementById('energy').innerText = energy;
        document.getElementById('en-bar').style.width = (energy / 10) + '%';
        document.getElementById('lvl-txt').innerText = name;
        document.getElementById('lvl-fill').style.width = ((xp - minXp) / (maxXp - minXp) * 100) + '%';
        document.getElementById('coin').innerText = characters[lvl-1] || "üêâ";
        document.getElementById('pwr-val').innerText = pLvl;
        document.getElementById('p-price').innerText = Math.floor(50 * Math.pow(2, pLvl - 1));

        localStorage.setItem('c', coins);
        localStorage.setItem('xp', xp);
        localStorage.setItem('pl', pLvl);
    }

    // –ö–õ–Ü–ö (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –Ω–∞–¥—ñ–π–Ω–∏–π onclick)
    document.getElementById('coin').onclick = function() {
        if (energy > 0) {
            coins += pLvl;
            xp += 1;
            energy -= 1;
            tg.HapticFeedback.impactOccurred('medium');
            update();
        }
    };

    // –ù–ê–í–Ü–ì–ê–¶–Ü–Ø
    function goTo(pgId, navId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(pgId).classList.add('active');
        document.getElementById(navId).classList.add('active');
        tg.HapticFeedback.impactOccurred('light');
    }

    document.getElementById('n-game').onclick = () => goTo('pg-game', 'n-game');
    document.getElementById('n-shop').onclick = () => goTo('pg-shop', 'n-shop');
    document.getElementById('n-task').onclick = () => goTo('pg-task', 'n-task');

    // –ö–£–ü–Ü–í–õ–Ø
    document.getElementById('buy-tap').onclick = function() {
        let price = Math.floor(50 * Math.pow(2, pLvl - 1));
        if (coins >= price) {
            coins -= price;
            pLvl += 1;
            update();
        }
    };

    // –ë–û–ù–£–°
    document.getElementById('claim-btn').onclick = function() {
        if (localStorage.getItem('clm_done') !== 'yes') {
            coins += 1000;
            localStorage.setItem('clm_done', 'yes');
            update();
        }
    };

    // –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó
    setInterval(() => {
        if (energy < 1000) {
            energy++;
            update();
        }
    }, 1500);

    update();
</script>
</body>
</html>
