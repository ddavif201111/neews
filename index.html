<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background: #121212; color: white; margin: 0; font-family: 'Segoe UI', Roboto, sans-serif; 
            overflow: hidden; width: 100vw; height: 100vh; display: flex; flex-direction: column;
            touch-action: none; transition: background 1s ease;
        }
        .header { text-align: center; padding: 20px 15px; background: rgba(44, 44, 44, 0.8); backdrop-filter: blur(10px); border-radius: 0 0 25px 25px; flex-shrink: 0; }
        #balance { font-size: 38px; font-weight: 900; color: #ffdf00; margin: 0; text-shadow: 0 0 15px rgba(255, 223, 0, 0.3); }
        
        .lvl-bar { width: 70%; background: #333; height: 6px; border-radius: 10px; margin: 10px auto; overflow: hidden; }
        #lvl-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #00c6ff, #0072ff); transition: width 0.3s; }
        
        .page { display: none; flex-grow: 1; flex-direction: column; align-items: center; justify-content: center; width: 100%; }
        .active { display: flex; }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–Ω–µ—Ç–∏ */
        .coin-container { flex-grow: 1; display: flex; align-items: center; justify-content: center; width: 100%; position: relative; }
        #coin { 
            width: 240px; height: 240px; background: radial-gradient(circle, #333, #000); 
            border: 8px solid #ffdf00; border-radius: 50%; display: flex; align-items: center; 
            justify-content: center; font-size: 100px; box-shadow: 0 0 50px rgba(255,223,0,0.2); 
            user-select: none; transition: transform 0.05s; z-index: 10;
        }
        #coin:active { transform: scale(0.92); }

        /* –ï—Ñ–µ–∫—Ç —Å–≤—è—Ç–∫—É–≤–∞–Ω–Ω—è */
        #celebration { position: absolute; font-size: 40px; pointer-events: none; display: none; z-index: 100; text-align: center; width: 100%; }

        /* –ú–µ–Ω—é (–ó–±–ª–∏–∂–µ–Ω–µ) */
        .nav { 
            height: 85px; display: flex; background: #1c1c1c; 
            justify-content: center; align-items: center; gap: 20px; /* –ó–±–ª–∏–∑–∏–≤ —ñ–∫–æ–Ω–∫–∏ —Ç—É—Ç */
            padding-bottom: 20px; border-top: 1px solid #333;
        }
        .nav-item { 
            opacity: 0.5; font-size: 11px; text-align: center; color: white; 
            width: 70px; transition: 0.3s;
        }
        .nav-item.active { opacity: 1; color: #0088cc; transform: translateY(-5px); }
        .nav-item span { font-size: 24px; display: block; margin-bottom: 2px; }

        .card { background: #242424; width: 90%; padding: 15px; border-radius: 18px; margin: 8px 0; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; }
        .btn { background: #0088cc; color: white; border: none; padding: 12px 18px; border-radius: 12px; font-weight: bold; }
    </style>
</head>
<body id="main-body">

<div id="celebration">üéâ üéà ü•≥<br>LEVEL UP!</div>

<div class="header">
    <div style="font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #888;" id="lvl-txt">–†—ñ–≤–µ–Ω—å 1</div>
    <div class="lvl-bar"><div id="lvl-fill"></div></div>
    <p id="balance">0</p>
</div>

<div id="game-pg" class="page active">
    <div class="coin-container">
        <div id="coin" onpointerdown="tap(event)">üêº</div>
    </div>
    <div style="width: 80%; padding-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 8px; color: #aaa;">
            <span>‚ö° –ï–Ω–µ—Ä–≥—ñ—è: <span id="energy">1000</span></span>
            <span>–ö–ª—ñ–∫: +<span id="pwr-val">1</span></span>
        </div>
        <div style="background: #222; height: 8px; border-radius: 10px; overflow: hidden; border: 1px solid #333;"><div id="en-bar" style="background: linear-gradient(90deg, #ff8c00, #ffdf00); width: 100%; height: 100%;"></div>
        </div>
    </div>
</div>

<div id="shop-pg" class="page">
    <div class="card"><div><b>Multi-Tap</b><br><small id="p-price">50</small></div><button class="btn" onclick="buy('p')">UP</button></div>
    <div class="card"><div><b>Auto-Bot</b><br><small id="f-price">150</small></div><button class="btn" onclick="buy('f')">UP</button></div>
</div>

<div id="task-pg" class="page">
    <div class="card"><div><b>Daily Welcome</b><br><small>+1,000</small></div><button class="btn" id="q-start" onclick="claim()">GET</button></div>
</div>

<div class="nav">
    <div class="nav-item active" onclick="nav('game-pg', this)"><span>üöÄ</span>–ü—Ä–æ—î–∫—Ç</div>
    <div class="nav-item" onclick="nav('shop-pg', this)"><span>üõí</span>–ú–∞–≥–∞–∑–∏–Ω</div>
    <div class="nav-item" onclick="nav('task-pg', this)"><span>üìù</span>–ó–∞–≤–¥–∞–Ω–Ω—è</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();
    tg.disableVerticalSwipes();

    let coins = parseInt(localStorage.getItem('c')) || 0;
    let pLvl = parseInt(localStorage.getItem('pl')) || 1;
    let fLvl = parseInt(localStorage.getItem('fl')) || 0;
    let xp = parseInt(localStorage.getItem('xp')) || 0;
    let energy = 1000;
    let currentLvl = 1;

    // –ï–≤–æ–ª—é—Ü—ñ—è –ü–∞–Ω–¥–∏ —Ç–∞ –§–æ–Ω–∏
    const characters = ["üêº", "üê®", "üêª", "üêØ", "ü¶Å", "üêâ"];
    const backgrounds = ["#121212", "#1a1a2e", "#16213e", "#1b1b2f", "#0f3460", "#1a1a1a"];

    function getLevelData(x) {
        if (x < 1000) return { l: 1, min: 0, max: 1000, n: "Baby Panda" };
        if (x < 3000) return { l: 2, min: 1000, max: 3000, n: "Warrior Panda" };
        if (x < 6000) return { l: 3, min: 3000, max: 6000, n: "Cyber Panda" };
        if (x < 8000) return { l: 4, min: 6000, max: 8000, n: "Elite Guardian" };
        let b = 8000, s = 5000, ex = Math.floor((x - b) / s) + 1;
        return { l: 4+ex, min: b+(ex-1)*s, max: b+ex*s, n: "Techno King" };
    }

    function update() {
        let ld = getLevelData(xp);
        
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
        if (ld.l > currentLvl) {
            showLevelUp();
            currentLvl = ld.l;
        }

        let pwr = Math.round(Math.pow(1.5, pLvl - 1));
        let ps = fLvl === 0 ? 0 : Math.round(2 * Math.pow(1.5, fLvl - 1));
        let prog = ((xp - ld.min) / (ld.max - ld.min)) * 100;

        document.getElementById('balance').innerText = Math.floor(coins).toLocaleString();
        document.getElementById('energy').innerText = Math.floor(energy);
        document.getElementById('en-bar').style.width = (energy / 10) + '%';
        document.getElementById('pwr-val').innerText = pwr;
        document.getElementById('lvl-fill').style.width = prog + '%';
        document.getElementById('lvl-txt').innerText = –†—ñ–≤–µ–Ω—å ${ld.l}: ${ld.n};
        document.getElementById('coin').innerText = characters[ld.l-1] || "üëë";
        
        // –ó–º—ñ–Ω–∞ —Ñ–æ–Ω—É
        document.getElementById('main-body').style.background = backgrounds[ld.l-1] || "#111";
        
        document.getElementById('p-price').innerText = Math.floor(50 * Math.pow(2, pLvl - 1));
        document.getElementById('f-price').innerText = Math.floor(150 * Math.pow(2.2, fLvl));

        localStorage.setItem('c', coins);
        localStorage.setItem('pl', pLvl);
        localStorage.setItem('fl', fLvl);
        localStorage.setItem('xp', xp);
    }

    function showLevelUp() {
        const div = document.getElementById('celebration');
        div.style.display = 'block';
        tg.HapticFeedback.notificationOccurred('success');
        setTimeout(() => { div.style.display = 'none'; }, 3000);
    }

    function tap(e) {
        if (e.cancelable) e.preventDefault();
        let pwr = Math.round(Math.pow(1.5, pLvl - 1));
        if (energy >= 1) {
            coins += pwr; energy--; xp++;
            tg.HapticFeedback.impactOccurred('medium');
            update();
        }
    }

    function buy(type) {
        let pp = Math.floor(50 * Math.pow(2, pLvl - 1));
        let fp = Math.floor(150 * Math.pow(2.2, fLvl));
        if (type === 'p' && coins >= pp) { coins -= pp; pLvl++; }
        else if (type === 'f' && coins >= fp) { coins -= fp; fLvl++; }
        update();
    }

    function claim() {
        if (localStorage.getItem('cl') !== 'y') {
            coins += 1000; localStorage.setItem('cl', 'y');
            document.getElementById('q-start').innerText = "‚úÖ"; update();
        }
    }

    function nav(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    }

    setInterval(() => {
        let ps = fLvl === 0 ? 0 : Math.round(2 * Math.pow(1.5, fLvl - 1));
        if (ps > 0) coins += (ps / 10);
        if (energy < 1000) energy++;
        update();
    }, 100);

    update();
</script>
</body>
</html>
