<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Working Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: sans-serif;
            background: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
            text-align: center;
            margin: 0;
            padding: 20px;
            user-select: none;
            touch-action: manipulation;
        }
        #coin {
            width: 200px;
            height: 200px;
            background: orange;
            border-radius: 50%;
            margin: 50px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            box-shadow: 0 10px 0 #d35400;
            cursor: pointer;
        }
        #coin:active { transform: translateY(5px); box-shadow: 0 5px 0 #d35400; }
        .stats { font-size: 24px; font-weight: bold; }
        .energy { color: gray; margin-top: 10px; }
        .btn {
            background: var(--tg-theme-button-color, #2481cc);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            width: 100%;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="stats">–ú–æ–Ω–µ—Ç–∏: <span id="balance">0</span></div>
    <div class="energy">–ï–Ω–µ—Ä–≥—ñ—è: <span id="energy">100</span>/100</div>

    <div id="coin">üí∞</div>

    <button class="btn" id="upgrade">–ü—Ä–æ–∫–∞—á–∞—Ç–∏ (–¶—ñ–Ω–∞: <span id="price">50</span>)</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
        function getData(key, def) {
            try {
                const res = localStorage.getItem(key);
                return res !== null ? Number(res) : def;
            } catch(e) { return def; }
        }

        let coins = getData('coins', 0);
        let power = getData('power', 1);
        let energy = getData('energy', 100);
        let lastTime = getData('lastTime', Date.now());

        // –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó –∑–∞ —á–∞—Å –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ
        const passed = Math.floor((Date.now() - lastTime) / 1000);
        energy = Math.min(100, energy + Math.floor(passed / 3));

        const balEl = document.getElementById('balance');
        const enEl = document.getElementById('energy');
        const priceEl = document.getElementById('price');

        function update() {
            balEl.innerText = Math.floor(coins);
            enEl.innerText = energy;
            const currentPrice = Math.floor(50 * Math.pow(1.75, power - 1));
            priceEl.innerText = currentPrice;
            
            localStorage.setItem('coins', coins);
            localStorage.setItem('power', power);
            localStorage.setItem('energy', energy);
            localStorage.setItem('lastTime', Date.now());
        }

        // –ö–õ–Ü–ö (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ 'touchstart' –¥–ª—è –º–∏—Ç—Ç—î–≤–æ—ó —Ä–µ–∞–∫—Ü—ñ—ó)
        document.getElementById('coin').addEventListener('touchstart', function(e) {
            e.preventDefault(); // –ó–∞–±–æ—Ä–æ–Ω–∞ —Å–∫—Ä–æ–ª—É
            if (energy > 0) {
                coins += power;
                energy -= 1;
                tg.HapticFeedback.impactOccurred('medium');
                update();
            }
        });

        // –ê–ü–ì–†–ï–ô–î
        document.getElementById('upgrade').onclick = function() {
            const currentPrice = Math.floor(50 * Math.pow(1.75, power - 1));
            if (coins >= currentPrice) {
                coins -= currentPrice;
                power += 1;
                update();
                tg.showAlert("–ü—Ä–æ–∫–∞—á–∞–Ω–æ!");
            }
        };

        // –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–Ω–ª–∞–π–Ω
        setInterval(() => {
            if (energy < 100) {
                energy++;
                update();
            }
        }, 3000);update();
    </script>
</body>
</html>
